process GLOBAL  = {

   ## setup useful services
   ##
   include "Validation/GlobalHits/data/Random.cfi"
   include "Validation/GlobalHits/data/MessageLogger.cfi"
   //service = Timing { }  
   //service = SimpleMemoryCheck { untracked int32 ignoreTotal = 1 } 

   ## Step 1 : Event Generation
   ##
   ## include a particle data table (pythia has theoretical)
   include "SimGeneral/HepPDTESSource/data/pdt.cfi"
   //include "SimGeneral/HepPDTESSource/data/pythiapdt.cfi"

   ## choose one of the following
   ##
   /*
   ## particle gun
   include "Validation/GlobalHits/data/FlatRandomEGunSource.cfi"
   replace FlatRandomEGunSource.maxEvents = 500
   replace FlatRandomEGunSource.PGunParameters.PartID = { 13, 11 }
   replace FlatRandomEGunSource.PGunParameters.MinE = 9.99
   replace FlatRandomEGunSource.PGunParameters.MaxE = 10.01
   replace FlatRandomEGunSource.Verbosity = 0
   ##
   */
   ## min bias Pythia
   include "IOMC/GeneratorInterface/data/PythiaSourceMinBias.cfi"	
   replace PythiaSource.maxEvents = 7000
   replace PythiaSource.pythiaHepMCVerbosity = false
   replace PythiaSource.pythiaPylistVerbosity = 0

   ## smearing of the vertex
   ##
   ##module VtxSmeared
   include "IOMC/EventVertexGenerators/data/VtxSmearedGauss.cfi" 
   //include "IOMC/EventVertexGenerators/data/VtxSmearedFlat.cfi"

   ## Step 2 : CMS Detector Simulation
   ##
   ## CMS Det.Simulation module (OscarProducer)
   ##
   ## Geometry
   ##
   ## can't use official yet as it is configuration.xml rather than 
   ## SimConfiguration (how to change?)
   include "Geometry/CMSCommonData/data/cmsSimIdealGeometryXML.cfi"
   es_module = TrackerGeometricDetESModule {}
		
   ## Magnetic Field
   ##
   include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
		
   ##module g4SimHits
   include "SimG4Core/Application/data/SimG4Object.cfi" 

   ## Step 3 : Accumulation of globally transformed data
   ##
   ## module globalhits
   include "Validation/GlobalHits/data/globalhits.cff"
   replace globalhits.Verbosity = 0
   replace globalhits.Frequency = 50

   ## Step 4 : Output module
   ##
   module o1 = PoolOutputModule 
   { 
      untracked string fileName = "GlobalHits.root"
      untracked vstring outputCommands = 
      {
        "keep *_globalhits_*_*"
      }
   }

   ## Step 5: execute path
   ## Global producer needs DetSim, 
   ## can use smeared vertex, can't use mixing
   ##
   path p1 = { VtxSmeared, g4SimHits, globalhits }
   endpath outpath = { o1 }
	
}
